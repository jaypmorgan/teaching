<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-12-04 sam. 16:09 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Programming Level-up</title>
<meta name="author" content="Jay Morgan" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Programming Level-up
<br />
<span class="subtitle">An Introduction to using Linux</span>
</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org6c84bda">1. Linux</a>
<ul>
<li><a href="#org12d9ed2">1.1. What is Linux</a>
<ul>
<li><a href="#org3ffec8a">1.1.1. What is Linux?</a></li>
<li><a href="#org066d947">1.1.2. What's a Distribution?</a></li>
<li><a href="#orgc151e50">1.1.3. What's a Distribution?</a></li>
<li><a href="#org345dba9">1.1.4. Defining Traits of Linux</a></li>
</ul>
</li>
<li><a href="#org1da4d95">1.2. The command line</a>
<ul>
<li><a href="#org50f5ef6">1.2.1. What's a command?</a></li>
<li><a href="#orgae77d7a">1.2.2. What is a command?</a></li>
<li><a href="#org9e5d2ed">1.2.3. What is a command?</a></li>
<li><a href="#org66e8a1e">1.2.4. What is a command?</a></li>
<li><a href="#orgeabfa63">1.2.5. What is a command?</a></li>
<li><a href="#org309f095">1.2.6. Very useful commands</a></li>
<li><a href="#org5efa7e8">1.2.7. Very useful commands &#x2013; mkdir</a></li>
<li><a href="#org50c6494">1.2.8. Very useful commands &#x2013; cp</a></li>
<li><a href="#orge198440">1.2.9. Very useful commands &#x2013; mv</a></li>
<li><a href="#orge2bd04a">1.2.10. Very useful commands &#x2013; rm</a></li>
<li><a href="#org583aa51">1.2.11. Very useful commands &#x2013; cat</a></li>
<li><a href="#org1c98c6c">1.2.12. Very useful commands &#x2013; pwd</a></li>
<li><a href="#org71f8227">1.2.13. Very useful commands &#x2013; find</a></li>
<li><a href="#org9dd7256">1.2.14. Very useful commands &#x2013; grep</a></li>
<li><a href="#org501c8c3">1.2.15. Very useful commands &#x2013; less/head/tail</a></li>
<li><a href="#org03c0e3b">1.2.16. Very useful commands &#x2013; wc</a></li>
<li><a href="#orga0519f7">1.2.17. Very useful commands &#x2013; piping</a></li>
<li><a href="#orgf2f98c3">1.2.18. Very useful basic commands</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgeba633c">2. Shell Scripting</a>
<ul>
<li><a href="#org8d10392">2.1. Writing bash scripts</a>
<ul>
<li><a href="#org4225c51">2.1.1. Very first bash script</a></li>
<li><a href="#orgc4d92ac">2.1.2. Very first bash script</a></li>
<li><a href="#org0eb4ede">2.1.3. Variables</a></li>
<li><a href="#org046d7d0">2.1.4. Interpolation in bash strings</a></li>
<li><a href="#org50be753">2.1.5. Bash strings &#x2013; the sharp edges</a></li>
<li><a href="#org42a0e76">2.1.6. Stopping interpolation in bash strings</a></li>
<li><a href="#org4fb596d">2.1.7. Input/Output</a></li>
<li><a href="#org92b94c4">2.1.8. Booleans</a></li>
<li><a href="#orga129ef8">2.1.9. Conditionals</a></li>
<li><a href="#org4a5c6b1">2.1.10. Conditionals</a></li>
<li><a href="#org43343b8">2.1.11. Conditionals</a></li>
<li><a href="#orga7cdf58">2.1.12. Conditionals</a></li>
<li><a href="#orga18b8f1">2.1.13. Loops</a></li>
<li><a href="#org9997d20">2.1.14. Loops</a></li>
<li><a href="#org8abb5e6">2.1.15. Loops</a></li>
<li><a href="#org55b9b56">2.1.16. Functions</a></li>
<li><a href="#orgb40cc6d">2.1.17. Functions</a></li>
<li><a href="#org6c3d481">2.1.18. Functions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga65e3cb">3. High Performance Cluster</a>
<ul>
<li><a href="#org3db9213">3.1. Getting started</a>
<ul>
<li><a href="#orgd2bda7d">3.1.1. What is the Cluster?</a></li>
<li><a href="#orgac79f35">3.1.2. How to login</a></li>
<li><a href="#org6e95f36">3.1.3. How to login</a></li>
<li><a href="#orgac58f28">3.1.4. How to login</a></li>
<li><a href="#org38485f4">3.1.5. How to copy files to and from the cluster</a></li>
<li><a href="#org541c015">3.1.6. Copying files &#x2013; rsync</a></li>
</ul>
</li>
<li><a href="#org46414f8">3.2. Submitting jobs</a>
<ul>
<li><a href="#org6ee2ed5">3.2.1. The Login- and Compute Nodes</a></li>
<li><a href="#org1e71149">3.2.2. How to launch a job &#x2013; srun</a></li>
<li><a href="#orgcbb99d0">3.2.3. How to launch a job &#x2013; options</a></li>
<li><a href="#org196b290">3.2.4. How to launch a job &#x2013; GPU allocation</a></li>
<li><a href="#org19b4477">3.2.5. How to launch a job &#x2013; GPU allocation</a></li>
<li><a href="#org05655d1">3.2.6. Learning more about nodes</a></li>
<li><a href="#orga606571">3.2.7. How to launch a job &#x2013; sbatch</a></li>
<li><a href="#org8335e07">3.2.8. How to launch a job &#x2013; sbatch</a></li>
<li><a href="#orgb3bda8d">3.2.9. How to launch a job &#x2013; sbatch</a></li>
<li><a href="#org086c578">3.2.10. Job Management &#x2013; squeue</a></li>
<li><a href="#orged2fe85">3.2.11. Job Management &#x2013; scancel</a></li>
<li><a href="#org9b02010">3.2.12. Job Management &#x2013; sacct</a></li>
<li><a href="#org399087f">3.2.13. Job Task Arrays &#x2013; motivation</a></li>
<li><a href="#org5259b7e">3.2.14. Job Task Arrays &#x2013; how to</a></li>
<li><a href="#org767811f">3.2.15. Job Task Arrays &#x2013; how to</a></li>
<li><a href="#org3f2112b">3.2.16. Job Task Arrays &#x2013; how to</a></li>
<li><a href="#org12cb7e9">3.2.17. Job Task Arrays &#x2013; how to</a></li>
<li><a href="#org2f6687d">3.2.18. Job Task Arrays &#x2013; how to</a></li>
<li><a href="#orge5395db">3.2.19. Job Task Arrays &#x2013; how to</a></li>
<li><a href="#orgb7b425a">3.2.20. Job Task Arrays &#x2013; how to</a></li>
</ul>
</li>
<li><a href="#orga4c5a07">3.3. A guided walk through</a>
<ul>
<li><a href="#org0de13b3">3.3.1. A guided walk through &#x2013; environment</a></li>
<li><a href="#org0473e3f">3.3.2. Writing our scripts</a></li>
<li><a href="#org5ccc76d">3.3.3. Writing our job submission script</a></li>
<li><a href="#org4b18daf">3.3.4. Replicating our environment on the cluster</a></li>
<li><a href="#org19ded2a">3.3.5. Sending our scripts to the cluster</a></li>
<li><a href="#org16cc28f">3.3.6. Logging into the cluster</a></li>
<li><a href="#org7e684de">3.3.7. Re-creating our development environment</a></li>
<li><a href="#org7c77380">3.3.8. Submitting our job</a></li>
<li><a href="#orgbf52f1a">3.3.9. Downloading the results</a></li>
<li><a href="#orga0284ff">3.3.10. Analysing the results</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org6c84bda" class="outline-2">
<h2 id="org6c84bda"><span class="section-number-2">1.</span> Linux</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org12d9ed2" class="outline-3">
<h3 id="org12d9ed2"><span class="section-number-3">1.1.</span> What is Linux</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org3ffec8a" class="outline-4">
<h4 id="org3ffec8a"><span class="section-number-4">1.1.1.</span> What is Linux?</h4>
<div class="outline-text-4" id="text-1-1-1">
<ul class="org-ul">
<li>Linux is a popular operating system (OS) like Windows, or MacOS.</li>
<li>Unlike these other two OSs, Linux is open source, which means the source code
is freely available to look at and modify.</li>
<li>As its open source, its very possible for anyone to build their <i>own</i> version of
Linux or build on top of Linux to create their own <i>Distribution</i> of Linux.</li>
</ul>
</div>
</div>

<div id="outline-container-org066d947" class="outline-4">
<h4 id="org066d947"><span class="section-number-4">1.1.2.</span> What's a Distribution?</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
A distribution can be considered like a <i>flavour</i> or version of Linux. There are
many popular flavours that attempt to meet different needs from different
users. For example:
</p>

<ul class="org-ul">
<li>Ubuntu &#x2013; typically the first Linux experience people will have. Attempts to be
very user friendly.</li>
<li>Fedora &#x2013; stable and secure distribution while also providing up-to-date packages.</li>
<li>Arch Linux &#x2013; strong focus on customisability rather than user friendliness
with bleeding edge packages.</li>
</ul>
</div>
</div>

<div id="outline-container-orgc151e50" class="outline-4">
<h4 id="orgc151e50"><span class="section-number-4">1.1.3.</span> What's a Distribution?</h4>
<div class="outline-text-4" id="text-1-1-3">

<div id="orgbac1021" class="figure">
<p><img src="images/family-tree.png" alt="family-tree.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org345dba9" class="outline-4">
<h4 id="org345dba9"><span class="section-number-4">1.1.4.</span> Defining Traits of Linux</h4>
<div class="outline-text-4" id="text-1-1-4">
<p>
While we have said that Linux is open source, there are many other traits that
make it stand out from other operating systems:
</p>

<ul class="org-ul">
<li>Complete control of how the system operates.</li>
<li>The level of flexibility and automation that you can get from using the Linux
command line.</li>
</ul>

<p>
While there are many other traits, these two are going to be what we're going to
focus on.
</p>
</div>
</div>
</div>

<div id="outline-container-org1da4d95" class="outline-3">
<h3 id="org1da4d95"><span class="section-number-3">1.2.</span> The command line</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org50f5ef6" class="outline-4">
<h4 id="org50f5ef6"><span class="section-number-4">1.2.1.</span> What's a command?</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
While many recent versions of Linux makes things more accessible via GUIs, they
will never be a substitute for using the command line. We're going to learn how
to control the system via the command line, via a <b>shell</b>. A shell, like the
Python REPL we've already seen, is waits for you to input commands, executes the
command, and prints the output if there is output to print.
</p>

<p>
A Linux command is a call to a program optionally followed by some
arguments. For example, if we want list out the files and folders in the
directory, we would use the <code>ls</code> (list) command:
</p>

<div class="org-src-container">
<pre class="src src-bash">ls
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae77d7a" class="outline-4">
<h4 id="orgae77d7a"><span class="section-number-4">1.2.2.</span> What is a command?</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
The <code>ls</code> command comes with a number of optional flags and arguments that we can
add onto the call. When calling a command a flag is something that begins with a
<code>-</code> , for example <code>-l</code> tells <code>ls</code> to list the directory in a list format.
</p>

<div class="org-src-container">
<pre class="src src-bash">ls -l
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e5d2ed" class="outline-4">
<h4 id="org9e5d2ed"><span class="section-number-4">1.2.3.</span> What is a command?</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
We have supplied the <code>-l</code> flag. There are many other flags for <code>ls</code>, like for
example, the human readable file systems with <code>-h</code> or show hidden files (files
that start with a period) with <code>-a</code>.
</p>

<p>
When we're using multiple flags we could write
</p>

<div class="org-src-container">
<pre class="src src-bash">ls -l -h -a
</pre>
</div>

<p>
Or:
</p>

<div class="org-src-container">
<pre class="src src-bash">ls -lha
</pre>
</div>
</div>
</div>

<div id="outline-container-org66e8a1e" class="outline-4">
<h4 id="org66e8a1e"><span class="section-number-4">1.2.4.</span> What is a command?</h4>
<div class="outline-text-4" id="text-1-2-4">
<p>
Sometimes commands take optional positional arguments. Going back to our list
directory command, where, by default, it will list the current directory. But
instead we can tell the command to list a particular directory by supplying the
path as an argument
</p>

<div class="org-src-container">
<pre class="src src-bash">ls images/ -lha
<span style="color: #b22222;"># </span><span style="color: #b22222;">or ls -lha images/ works too</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeabfa63" class="outline-4">
<h4 id="orgeabfa63"><span class="section-number-4">1.2.5.</span> What is a command?</h4>
<div class="outline-text-4" id="text-1-2-5">
<p>
How do I know how to use a command? Well that's where another command comes
in. It's called <code>man</code> (short for manual). If you pass another command to the <code>man</code>
command, the documentation will be shown in the terminal, e.g.:
</p>

<div class="org-src-container">
<pre class="src src-bash">man ls  <span style="color: #b22222;"># </span><span style="color: #b22222;">display the documentation for ls</span>
</pre>
</div>

<p>
The documentation should list all the different flags and arguments, describe
what they mean, and sometimes give example or most common usage of a command.
</p>

<p>
When the 'man page' is display, you can scroll up and down the page using your
arrow keys, and page-up and page-down. When you're done reading, just hit the
'q' character
</p>
</div>
</div>

<div id="outline-container-org309f095" class="outline-4">
<h4 id="org309f095"><span class="section-number-4">1.2.6.</span> Very useful commands</h4>
<div class="outline-text-4" id="text-1-2-6">
<p>
I am going to go through some of the most common commands just to make sure that
you're familiar with the typical usage.
</p>

<p>
We've already seen <code>ls</code> to list a directory. The command to move to a directory is
<code>cd</code> (change directory), that takes an argument of filepath to move to:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #483d8b;">cd</span> ~ <span style="color: #b22222;"># </span><span style="color: #b22222;">tilde is short-hand for the 'home directory'</span>
<span style="color: #483d8b;">cd</span> ~/Documents/My<span style="color: #8b2252;">\ </span>Files  <span style="color: #b22222;"># </span><span style="color: #b22222;">go to Documents and then to "My Files"</span>
<span style="color: #483d8b;">cd</span>   <span style="color: #b22222;"># </span><span style="color: #b22222;">no argument, by default goes to the home directory</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5efa7e8" class="outline-4">
<h4 id="org5efa7e8"><span class="section-number-4">1.2.7.</span> Very useful commands &#x2013; mkdir</h4>
<div class="outline-text-4" id="text-1-2-7">
<p>
Sticking with the them of directories, to make a new directory we use <code>mkdir</code>,
whose argument takes the name of the directory we want to create:
</p>

<div class="org-src-container">
<pre class="src src-bash">mkdir my_new_directory
</pre>
</div>

<p>
You can create a many level nested directory structure all at once using the <code>-p</code>
(parents) flag, that tells <code>mkdir</code> if the parent directory of the target directory
doesn't exist, create it.
</p>

<div class="org-src-container">
<pre class="src src-bash">mkdir photos/2020/01/05  <span style="color: #b22222;"># </span><span style="color: #b22222;">won't work unless photos/2020/01 exist</span>
mkdir -p photos/2020/01/05  <span style="color: #b22222;"># </span><span style="color: #b22222;">this will work</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org50c6494" class="outline-4">
<h4 id="org50c6494"><span class="section-number-4">1.2.8.</span> Very useful commands &#x2013; cp</h4>
<div class="outline-text-4" id="text-1-2-8">
<p>
To copy a file or directory, we can use the <code>cp</code> command. Here we are copying a
file, where the first argument is the filepath of the file you want to copy and the second
argument is the filepath where the copy should be placed.
</p>

<div class="org-src-container">
<pre class="src src-bash">cp my_old_file my_new_file
</pre>
</div>

<p>
By default (without a flag), <code>cp</code> will not work with directories, for that you
have to use the <code>-r</code> (recursive) flag
</p>

<div class="org-src-container">
<pre class="src src-bash">cp -r data/ data-backup
</pre>
</div>
</div>
</div>

<div id="outline-container-orge198440" class="outline-4">
<h4 id="orge198440"><span class="section-number-4">1.2.9.</span> Very useful commands &#x2013; mv</h4>
<div class="outline-text-4" id="text-1-2-9">
<p>
The syntax of moving a file is similar to that of <code>cp</code>:
</p>

<div class="org-src-container">
<pre class="src src-bash">mv old_file new_file
</pre>
</div>

<p>
Except that it works for both files and directories without any flags. <code>mv</code> can
also be used to <b>rename</b> files, that's all renaming is: moving a file to the same
directory under a different name.
</p>
</div>
</div>

<div id="outline-container-orge2bd04a" class="outline-4">
<h4 id="orge2bd04a"><span class="section-number-4">1.2.10.</span> Very useful commands &#x2013; rm</h4>
<div class="outline-text-4" id="text-1-2-10">
<p>
To remove a file us <code>rm</code>:
</p>

<div class="org-src-container">
<pre class="src src-bash">rm file_to_delete
</pre>
</div>

<p>
If you want to delete a directory, use the <code>-r</code> (recursive) flag:
</p>

<div class="org-src-container">
<pre class="src src-bash">rm -r directory_to_delete/
</pre>
</div>
</div>
</div>

<div id="outline-container-org583aa51" class="outline-4">
<h4 id="org583aa51"><span class="section-number-4">1.2.11.</span> Very useful commands &#x2013; cat</h4>
<div class="outline-text-4" id="text-1-2-11">
<p>
<code>cat</code> stands for concatenate, i.e. concatenating the contents of two or more
files:
</p>

<div class="org-src-container">
<pre class="src src-bash">cat file1 file2
</pre>
</div>

<p>
The result is that the concatenation of these two files will be printed to the
screen. If you wanted to put the result into its own file you would redirect the
output using <code>&gt;</code>
</p>

<div class="org-src-container">
<pre class="src src-bash">cat file1 file2 &gt; newfile
</pre>
</div>

<p>
Since cat reads the file and prints it to screen it is a very handy way to view
the contents of a file, even if it was not intended for that.
</p>
</div>
</div>

<div id="outline-container-org1c98c6c" class="outline-4">
<h4 id="org1c98c6c"><span class="section-number-4">1.2.12.</span> Very useful commands &#x2013; pwd</h4>
<div class="outline-text-4" id="text-1-2-12">
<p>
Sometimes you may get lost when moving directories. <code>pwd</code> prints the current
working directory from the root directory, i.e. the path that is printed is an
absolute path.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #483d8b;">pwd</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org71f8227" class="outline-4">
<h4 id="org71f8227"><span class="section-number-4">1.2.13.</span> Very useful commands &#x2013; find</h4>
<div class="outline-text-4" id="text-1-2-13">
<p>
If we want to list all files of a certain type, we can use the wildcard <code>*</code> that
we've seen before:
</p>

<div class="org-src-container">
<pre class="src src-bash">ls *.jpg <span style="color: #b22222;"># </span><span style="color: #b22222;">list all files that end with .jpg</span>
</pre>
</div>

<p>
However, this will only list for the current directory. Perhaps the better way
to find files will be using the <code>find</code> command:
</p>

<div class="org-src-container">
<pre class="src src-bash">find . -type f -name *.jpg
</pre>
</div>

<p>
The first argument is the directory to start the search, then we define the type
<code>f</code> being files, and then specify the name. Find will recursively search through
directories and sub-directories to find all files that match that name.
</p>
</div>
</div>

<div id="outline-container-org9dd7256" class="outline-4">
<h4 id="org9dd7256"><span class="section-number-4">1.2.14.</span> Very useful commands &#x2013; grep</h4>
<div class="outline-text-4" id="text-1-2-14">
<p>
How about if we want to find files that have a certain contents? For that we can
use <code>grep</code>. Grep will read a file and print (by default) the lines that contains
your pattern. i.e.:
</p>

<div class="org-src-container">
<pre class="src src-bash">grep <span style="color: #8b2252;">'Linux'</span> lecture.org
</pre>
</div>

<p>
This will print the lines that contain the word Linux in lecture.org. If we just
want the matched value, we use the <code>-o</code> flag.
</p>

<div class="org-src-container">
<pre class="src src-bash">grep -o <span style="color: #8b2252;">'[0-9]'</span> lecture.org
</pre>
</div>

<p>
This prints all occurrences of numbers in lecture.org
</p>
</div>
</div>

<div id="outline-container-org501c8c3" class="outline-4">
<h4 id="org501c8c3"><span class="section-number-4">1.2.15.</span> Very useful commands &#x2013; less/head/tail</h4>
<div class="outline-text-4" id="text-1-2-15">
<p>
If a file is very long, we may not want to read the file using cat, as it will
have to print the entire file. Instead we could use <code>less</code>, which will allow us to
navigate through the file, using arrow keys to move and <code>q</code> to quit.
</p>

<div class="org-src-container">
<pre class="src src-bash">less filename
</pre>
</div>

<p>
If we just want to view the first few lines, or the last few lines of a file we
can use head/tail, respectively:
</p>

<div class="org-src-container">
<pre class="src src-bash">head filename
tail -n 20 filename  <span style="color: #b22222;"># </span><span style="color: #b22222;">last 20 lines</span>
tail -F filename <span style="color: #b22222;"># </span><span style="color: #b22222;">constantly read the file</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org03c0e3b" class="outline-4">
<h4 id="org03c0e3b"><span class="section-number-4">1.2.16.</span> Very useful commands &#x2013; wc</h4>
<div class="outline-text-4" id="text-1-2-16">
<p>
Often times we just want to count the number of something. For example, if we
want to count the number of files/folders in the directory we can do:
</p>

<div class="org-src-container">
<pre class="src src-bash">ls -l | wc -l
</pre>
</div>

<p>
We're first printing all files and folders in a list format (one per line), then
passing (<sub>piping</sub>_) the result to <code>wc</code>, which with the <code>-l</code> line flag, is counting the
number of lines. Therefore we get a count of the number of files and
folders. Here is another example where we're counting how many times the word
bash appears in these lecture notes:
</p>

<div class="org-src-container">
<pre class="src src-bash">grep -o <span style="color: #8b2252;">'bash'</span> lecture.org | wc -l
</pre>
</div>
</div>
</div>

<div id="outline-container-orga0519f7" class="outline-4">
<h4 id="orga0519f7"><span class="section-number-4">1.2.17.</span> Very useful commands &#x2013; piping</h4>
<div class="outline-text-4" id="text-1-2-17">
<p>
The purpose of piping is to pass data around between commands. We have just seen
how we can pass the output of, say, the <code>ls</code> command to  the input of <code>wc</code>. This
allows use to construct very sophisticated pipelines to do some quite complex
things from the combination of very simple commands.
</p>

<div class="org-src-container">
<pre class="src src-bash">find . -name <span style="color: #8b2252;">'*.txt'</span> -type f -print0 | xargs -0 grep <span style="color: #8b2252;">"something"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2f98c3" class="outline-4">
<h4 id="orgf2f98c3"><span class="section-number-4">1.2.18.</span> Very useful basic commands</h4>
<div class="outline-text-4" id="text-1-2-18">
<p>
In summary we have seen the following commands:
</p>

<ul class="org-ul">
<li><code>ls</code> - List a directory</li>
<li><code>cd</code> - Change/move to a directory</li>
<li><code>mkdir</code> - Make a new directory</li>
<li><code>cat</code> - Concatenate files</li>
<li><code>cp</code> - Copy a file/directory</li>
<li><code>mv</code> - Move files/folders</li>
<li><code>rm</code> - Remove files and folders</li>
<li><code>pwd</code> - Display the current absolute path</li>
<li><code>find</code> - Find files</li>
<li><code>grep</code> - Find occurrences of a pattern in a file</li>
<li><code>less/head/tail</code> - Read a file</li>
<li><code>wc</code> - Count</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeba633c" class="outline-2">
<h2 id="orgeba633c"><span class="section-number-2">2.</span> Shell Scripting</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org8d10392" class="outline-3">
<h3 id="org8d10392"><span class="section-number-3">2.1.</span> Writing bash scripts</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org4225c51" class="outline-4">
<h4 id="org4225c51"><span class="section-number-4">2.1.1.</span> Very first bash script</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
Let's start with the classic 'Hello, World' example. We'll create a new file
called 'hello.sh' and enter the following:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Hello, World!"</span>
</pre>
</div>

<p>
First thing to notice is that the first line contains what we call a 'shebang'
or 'hashbang'. It tells Linux which shell interpreter will be used to run the
script, in this case: /bin/bash
</p>

<p>
The next (non-empty) line in the file is <code>echo 'Hello, World'</code>. This is exactly
the same as the other commands we've just seen.
</p>
</div>
</div>

<div id="outline-container-orgc4d92ac" class="outline-4">
<h4 id="orgc4d92ac"><span class="section-number-4">2.1.2.</span> Very first bash script</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
Now that we've created and saved our bash script, we will want to run it. We
have two alternative methods to run this script:
</p>

<div class="org-src-container">
<pre class="src src-bash">bash hello.sh  <span style="color: #b22222;"># </span><span style="color: #b22222;">run the script via bash</span>
</pre>
</div>

<p>
The second, requires that we have executable privileges for the script:
</p>

<div class="org-src-container">
<pre class="src src-bash">chmod +x hello.sh  <span style="color: #b22222;"># </span><span style="color: #b22222;">add executable 'x' privileges</span>
./hello.sh  <span style="color: #b22222;"># </span><span style="color: #b22222;">execute it</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0eb4ede" class="outline-4">
<h4 id="org0eb4ede"><span class="section-number-4">2.1.3.</span> Variables</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
The variables we create in our bash scripts are very much the same as the
environment variables we've seen before. Take for example:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span style="color: #a0522d;">AGE</span>=<span style="color: #8b2252;">"35"</span>
<span style="color: #a0522d;">PERSON_NAME</span>=<span style="color: #8b2252;">"Jane"</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$PERSON_NAME is $AGE years old"</span>
</pre>
</div>

<p>
We create a variable <code>AGE</code> with the <code>=</code> assignment operator. <b>Note</b> we don't put
spaces either side of the equals sign in bash. To refer to the variable, we use
<code>$AGE</code>, using the <code>$</code> dollar sign.
</p>
</div>
</div>

<div id="outline-container-org046d7d0" class="outline-4">
<h4 id="org046d7d0"><span class="section-number-4">2.1.4.</span> Interpolation in bash strings</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
You would have noticed in the previous example that we included the variable
directly into the string we're echoing out. This is something similar to what
we've seen with f-strings in Python.
</p>

<p>
When we use double quotes: <code>"..."</code>  in bash, the variable will be integrated into
the resulting string. We can even call bash functions from directly inside the
string:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"I am logging in as: $(</span><span style="color: #ff00ff;">who</span><span style="color: #8b2252;">)"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org50be753" class="outline-4">
<h4 id="org50be753"><span class="section-number-4">2.1.5.</span> Bash strings &#x2013; the sharp edges</h4>
<div class="outline-text-4" id="text-2-1-5">
<p>
You might be tempted to use a variable when generating a path:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a0522d;">TRAIN_PROCESS</span>=<span style="color: #8b2252;">"training"</span>
<span style="color: #a0522d;">TEST_PROCESS</span>=<span style="color: #8b2252;">"testing"</span>

touch <span style="color: #8b2252;">"./data/$TRAIN_PROCESS_error.txt"</span>
touch <span style="color: #8b2252;">"./data/$TEST_PROCESS_error.txt</span>
</pre>
</div>

<p>
But this will create an error as underscores can be part of the variable name,
so bash will be looking for a variable named: <code>$TRAIN_PROCESS_error</code> which has
never been created. To get around this, we can wrap our variable in curly
braces:
</p>

<div class="org-src-container">
<pre class="src src-bash">touch <span style="color: #8b2252;">"./data/${TRAIN_PROCESS}_error.txt"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org42a0e76" class="outline-4">
<h4 id="org42a0e76"><span class="section-number-4">2.1.6.</span> Stopping interpolation in bash strings</h4>
<div class="outline-text-4" id="text-2-1-6">
<p>
We can also use single quotes for strings in bash. When we use these strings,
the string itself is <span class="underline">not</span> interpreted, and thus it will ignore any variables or
bash commands:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'I am logging in as: $(</span><span style="color: #ff00ff;">who</span><span style="color: #8b2252;">)'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fb596d" class="outline-4">
<h4 id="org4fb596d"><span class="section-number-4">2.1.7.</span> Input/Output</h4>
<div class="outline-text-4" id="text-2-1-7">
<p>
If we want to read the input from keyboard into a variable, we use the read
command:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Enter your name:"</span>
<span style="color: #483d8b;">read</span> NAME

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Hello, $NAME"</span>
</pre>
</div>

<p>
<code>read</code> in this context will read in the input and create the variable with that
value. As we've already seen, we can then output this value to the console using
the echo command.
</p>
</div>
</div>

<div id="outline-container-org92b94c4" class="outline-4">
<h4 id="org92b94c4"><span class="section-number-4">2.1.8.</span> Booleans</h4>
<div class="outline-text-4" id="text-2-1-8">
<p>
Technically, bash does not have built in data types for true and false, but
Linux has the commands true and false which we could use in place. The
implementation of how these commands work is not important.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a0522d;">FILE_EXISTS</span>=true

<span style="color: #a020f0;">if</span> [ <span style="color: #8b2252;">"$FILE_EXISTS"</span> = true ]; <span style="color: #a020f0;">then</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The file exists!"</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orga129ef8" class="outline-4">
<h4 id="orga129ef8"><span class="section-number-4">2.1.9.</span> Conditionals</h4>
<div class="outline-text-4" id="text-2-1-9">
<p>
When we're creating <code>if</code> expressions, we use the following syntax:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a020f0;">if</span> &lt;&lt;conditional&gt;&gt;; <span style="color: #a020f0;">then</span>
<span style="color: #ffa54f;">   # do something</span>
<span style="color: #ffa54f;">else</span>
<span style="color: #ffa54f;">   # do something else</span>
<span style="color: #ffa54f;">fi</span>
</pre>
</div>

<p>
We can also use <code>elif</code>
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a020f0;">if</span> &lt;&lt;conditional&gt;&gt;; <span style="color: #a020f0;">then</span>
<span style="color: #ffa54f;">   # do something</span>
<span style="color: #ffa54f;">elif &lt;&lt;conditional&gt;&gt;; then</span>
<span style="color: #ffa54f;">   # do something else</span>
<span style="color: #ffa54f;">else</span>
<span style="color: #ffa54f;">   # something else entirely</span>
<span style="color: #ffa54f;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a5c6b1" class="outline-4">
<h4 id="org4a5c6b1"><span class="section-number-4">2.1.10.</span> Conditionals</h4>
<div class="outline-text-4" id="text-2-1-10">
<p>
Writing condition expressions can be a little more cumbersome than in
Python. These can be many pain points for new bash programmers, take for
example:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a0522d;">FILE_EXISTS</span>=false

<span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">FILE_EXISTS</span> ]; <span style="color: #a020f0;">then</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The file exists!"</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>

<p>
This is because we have used the <code>[...]</code> single bracket syntax for the test. But
there are others:
</p>

<ul class="org-ul">
<li>No brackets: we could omit the brackets in which case it would run the false
command not print the statement.</li>
<li>Single paranthesis <code>(...)</code> creates a sub-shell.</li>
<li>Double paranthesis <code>((...))</code> for arithmetic operation</li>
<li>Single square bracket <code>[...]</code> calls <code>test</code></li>
<li>Double square bracket <code>[[...]]</code></li>
</ul>
</div>
</div>

<div id="outline-container-org43343b8" class="outline-4">
<h4 id="org43343b8"><span class="section-number-4">2.1.11.</span> Conditionals</h4>
<div class="outline-text-4" id="text-2-1-11">
<p>
What if we write:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a0522d;">VAR_1</span>=<span style="color: #8b2252;">"Mr Foo Bar"</span>
<span style="color: #a0522d;">VAR_2</span>=<span style="color: #8b2252;">"Mr Foo Bar"</span>
<span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">VAR_1</span> = $<span style="color: #a0522d;">VAR_2</span> ]; <span style="color: #a020f0;">then</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"They are the same"</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>

<p>
We would get an error because <code>test</code> expands the arguments into:
</p>

<pre class="example">
Mr Foo Bar = Mr Foo Bar
</pre>

<p>
With the spaces included. To prevent this from happening, we have to wrap the
variables in quotation marks.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a0522d;">VAR_1</span>=<span style="color: #8b2252;">"Mr Foo Bar"</span>
<span style="color: #a0522d;">VAR_2</span>=<span style="color: #8b2252;">"Mr Foo Bar"</span>
<span style="color: #a020f0;">if</span> [ <span style="color: #8b2252;">"$VAR_1"</span> = <span style="color: #8b2252;">"$VAR_2"</span> ]; <span style="color: #a020f0;">then</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"They are the same"</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7cdf58" class="outline-4">
<h4 id="orga7cdf58"><span class="section-number-4">2.1.12.</span> Conditionals</h4>
<div class="outline-text-4" id="text-2-1-12">
<p>
If we use <code>[[</code> in if statement, then we can do more sophisticated things like
pattern matching:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a0522d;">FILENAME</span>=<span style="color: #8b2252;">"testing.png"</span>
<span style="color: #a020f0;">if</span> [[ <span style="color: #8b2252;">"$FILENAME"</span> = *.png ]]; <span style="color: #a020f0;">then</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Its a png file"</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga18b8f1" class="outline-4">
<h4 id="orga18b8f1"><span class="section-number-4">2.1.13.</span> Loops</h4>
<div class="outline-text-4" id="text-2-1-13">
<p>
Like in Python, we can iterate in bash
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a020f0;">for</span> i<span style="color: #a020f0;"> in</span> {1..10}; <span style="color: #a020f0;">do</span>
    <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">i</span>
<span style="color: #a020f0;">done</span>
</pre>
</div>

<p>
This iterates with i starting at 1 upto 10 (inclusive). Or we could do:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a020f0;">for</span> (( <span style="color: #a0522d;">i</span>=1; i &lt;= 10; i++ )); <span style="color: #a020f0;">do</span>
    <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">i</span>
<span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9997d20" class="outline-4">
<h4 id="org9997d20"><span class="section-number-4">2.1.14.</span> Loops</h4>
<div class="outline-text-4" id="text-2-1-14">
<p>
We can also iterate over a list of files/folders in a directory:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a020f0;">for</span> FILE<span style="color: #a020f0;"> in</span> ./images/*; <span style="color: #a020f0;">do</span>
    <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">FILE</span>
<span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8abb5e6" class="outline-4">
<h4 id="org8abb5e6"><span class="section-number-4">2.1.15.</span> Loops</h4>
<div class="outline-text-4" id="text-2-1-15">
<p>
Using the <code>while</code> form, we can continue looping until our conditional is
false. For example, we could loop testing our internet connection, until its
been established:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a020f0;">while</span> ! ping -c 1 google.com; <span style="color: #a020f0;">do</span>
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"No internet yet"</span>
    sleep 1
<span style="color: #a020f0;">done</span>

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Internet is available!"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org55b9b56" class="outline-4">
<h4 id="org55b9b56"><span class="section-number-4">2.1.16.</span> Functions</h4>
<div class="outline-text-4" id="text-2-1-16">
<p>
To create a function, we use the following syntax:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000ff;">function_name</span>() {
    <span style="color: #b22222;"># </span><span style="color: #b22222;">do something</span>
}
</pre>
</div>

<p>
And to call the function, you just need to use the function name:
</p>

<div class="org-src-container">
<pre class="src src-bash">function_name <span style="color: #b22222;"># </span><span style="color: #b22222;">this called function name</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb40cc6d" class="outline-4">
<h4 id="orgb40cc6d"><span class="section-number-4">2.1.17.</span> Functions</h4>
<div class="outline-text-4" id="text-2-1-17">
<p>
Here is another example:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000ff;">say_hello</span>() {
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Hello, $1"</span>
}

say_hello <span style="color: #8b2252;">"Jane"</span>
</pre>
</div>

<p>
Notice that we didn't need to include any argument list. We just used <code>$1</code> for the
first argument passed to the function.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000ff;">say_hello</span>() {
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$1, $2"</span>
}

say_hello <span style="color: #8b2252;">"Hi"</span> <span style="color: #8b2252;">"Jane"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c3d481" class="outline-4">
<h4 id="org6c3d481"><span class="section-number-4">2.1.18.</span> Functions</h4>
<div class="outline-text-4" id="text-2-1-18">
<p>
Returning values is 'interesting' as, coming from other languages, you think
could do something like this:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000ff;">say_hello</span>() {
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"hello"</span>
}
<span style="color: #a0522d;">RESULT</span>=<span style="color: #8b2252;">"$(</span><span style="color: #ff00ff;">say_hello</span><span style="color: #8b2252;">)"</span>
<span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">RESULT</span>
</pre>
</div>

<p>
This didn't work like we expected, the value wasn't returned and assigned to
<code>RESULT</code>. So how do we return a value?
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0000ff;">say_hello</span>() {
    <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Hello"</span>
}
<span style="color: #a0522d;">RESULT</span>=<span style="color: #8b2252;">"$(</span><span style="color: #ff00ff;">say_hello</span><span style="color: #8b2252;">)"</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"This is before the printing of result"</span>
<span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">RESULT</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orga65e3cb" class="outline-2">
<h2 id="orga65e3cb"><span class="section-number-2">3.</span> High Performance Cluster</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org3db9213" class="outline-3">
<h3 id="org3db9213"><span class="section-number-3">3.1.</span> Getting started</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-orgd2bda7d" class="outline-4">
<h4 id="orgd2bda7d"><span class="section-number-4">3.1.1.</span> What is the Cluster?</h4>
</div>

<div id="outline-container-orgac79f35" class="outline-4">
<h4 id="orgac79f35"><span class="section-number-4">3.1.2.</span> How to login</h4>
<div class="outline-text-4" id="text-3-1-2">
<div class="org-src-container">
<pre class="src src-bash">ssh &lt;&lt;username&gt;&gt;@saphir2.lis-lab.fr
</pre>
</div>

<p>
Then:
</p>

<div class="org-src-container">
<pre class="src src-bash">ssh &lt;&lt;username&gt;&gt;@sms-ext.lis-lab.fr
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e95f36" class="outline-4">
<h4 id="org6e95f36"><span class="section-number-4">3.1.3.</span> How to login</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
Typing both these commands can become tiresome very quickly. But we can make it
a lot easier by updating our <code>~/.ssh/config</code> file to include something like:
</p>

<pre class="example" id="orgcfa11a2">
Host saphir2
     HostName saphir2.lis-lab.fr
     User &lt;&lt;username&gt;&gt;

Host cluster
     HostName sms-ext.lis-lab.fr
     User &lt;&lt;username&gt;&gt;
     ProxyCommand ssh saphir2 -W %h:%p
</pre>

<p>
Then to login to the cluster, we just need to type:
</p>

<div class="org-src-container">
<pre class="src src-bash">ssh cluster
</pre>
</div>

<p>
And we should be prompted for our password.
</p>
</div>
</div>

<div id="outline-container-orgac58f28" class="outline-4">
<h4 id="orgac58f28"><span class="section-number-4">3.1.4.</span> How to login</h4>
<div class="outline-text-4" id="text-3-1-4">
<p>
If you trust the machine your on, you can remove password authentication and
move to key-based authentication:
</p>

<div class="org-src-container">
<pre class="src src-bash">ssh-copy-id saphir2
ssh-copy-id cluster
</pre>
</div>

<p>
When we next login to the server, we shouldn't be prompted for a password.
</p>
</div>
</div>

<div id="outline-container-org38485f4" class="outline-4">
<h4 id="org38485f4"><span class="section-number-4">3.1.5.</span> How to copy files to and from the cluster</h4>
<div class="outline-text-4" id="text-3-1-5">
<p>
We have a number of options for transferring files to and from the
cluster. Firstly, let's look at the command <code>scp</code>. It takes two arguments, the
first argument is the file you want to send, the second argument is the
destination of the sent file.
</p>

<div class="org-src-container">
<pre class="src src-bash">scp &lt;&lt;origin&gt;&gt; &lt;&lt;destination&gt;&gt;
</pre>
</div>

<p>
Similar to commands like <code>cp</code>, scp by default only works for files, not
folders. To send folders/directories, we use the <code>-r</code> flag just like <code>cp</code>.
</p>

<div class="org-src-container">
<pre class="src src-bash">scp -r &lt;&lt;origin_folder&gt;&gt; &lt;&lt;destination_folder&gt;&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org541c015" class="outline-4">
<h4 id="org541c015"><span class="section-number-4">3.1.6.</span> Copying files &#x2013; rsync</h4>
<div class="outline-text-4" id="text-3-1-6">
<p>
One of the downsides about <code>scp</code> is that it will copy every file you give
it. Even if the file at the destination is exactly the same. What if we only
want to copy files that need to be copied, i.e. that are outdated, thus saving
time? For that, we can use <code>rsync</code>. Rsync will copy files from one source to a
destination only if the destination needs to be updated. This can save a lot of
time by skipping files that already exist at the destination:
</p>

<div class="org-src-container">
<pre class="src src-bash">rsync &lt;&lt;source&gt;&gt; &lt;&lt;destination&gt;&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org46414f8" class="outline-3">
<h3 id="org46414f8"><span class="section-number-3">3.2.</span> Submitting jobs</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org6ee2ed5" class="outline-4">
<h4 id="org6ee2ed5"><span class="section-number-4">3.2.1.</span> The Login- and Compute Nodes</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
When you login to the cluster, you are logging into the <i>login</i> node. <b>Note</b> that no
computation should be run on this node. If you want to run scripts, you will
have to submit a job to the compute nodes.
</p>

<p>
On the login node there is a system installed called 'SLURM'. SLURM is a job
scheduler program that receives your requests for executing scripts, it will
queue them and assign them to available compute nodes.
</p>

<p>
We will take a look at how to request and manage jobs using the various commands
that SLURM provides.
</p>
</div>
</div>

<div id="outline-container-org1e71149" class="outline-4">
<h4 id="org1e71149"><span class="section-number-4">3.2.2.</span> How to launch a job &#x2013; srun</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
The first command we will look at it is <code>srun</code>. This command will run request a
job for execution in 'real-time'. By real-time, we mean that the shell will wait
until the job has been submitted.
</p>

<div class="org-src-container">
<pre class="src src-bash">srun &lt;&lt;compute node options&gt;&gt; &lt;&lt;command to run&gt;&gt;
</pre>
</div>

<p>
Let's take a look at an example where we want to run an interactive bash shell
on the compute shell (similar to ssh'ing into the compute node).
</p>

<div class="org-src-container">
<pre class="src src-bash">srun --time=00:10:00 --pty bash -l
</pre>
</div>

<p>
This will request a job on any available compute node for 10 minutes. When a
node becomes available, <code>bash</code> will execute, dropping you into the shell. You will
notice that the shell prompt has changed from <code>sms</code> to the name of the node.
</p>
</div>
</div>

<div id="outline-container-orgcbb99d0" class="outline-4">
<h4 id="orgcbb99d0"><span class="section-number-4">3.2.3.</span> How to launch a job &#x2013; options</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
In the previous command, we used the <code>--time</code> option to specify how long the job
will run for. But there are other options we can use to be more specific about
the jobs we want to run.
</p>

<p>
<code>--cpus-per-task</code> can be used to request more than one CPU to be
allocated. This is especially helpful when we have a multithreaded process we
want to run.
</p>

<p>
<code>--mem</code> specifies how much memory should be allocated to the job. For example:
<code>--mem=16G</code> tells SLURM to allocate 16 GB of memory.
</p>
</div>
</div>

<div id="outline-container-org196b290" class="outline-4">
<h4 id="org196b290"><span class="section-number-4">3.2.4.</span> How to launch a job &#x2013; GPU allocation</h4>
<div class="outline-text-4" id="text-3-2-4">
<p>
If we need to use a GPU, we need to use a few options. Firstly, we can specify
that our job is on a compute node with GPU. There will usually be a group of
nodes in a 'GPU' group or partition, and thus we can specify to use one of these
partitions:
</p>

<div class="org-src-container">
<pre class="src src-bash">srun --time=00:10:00 --partiton=gpu --pty bash -l
</pre>
</div>

<p>
But you will notice that you still do not have access to a GPU. You're running
on the GPU node, but you haven't actually requested a GPU be allocated to your
job. For that you will use <code>--gres</code>:
</p>

<div class="org-src-container">
<pre class="src src-bash">srun --time=00:10:00 --partition=gpu --gres=gpu:1 --pty bash -l
</pre>
</div>

<p>
Here we are requesting one GPU, but if we use <code>--gres:gpu:2</code> we are requesting 2
GPUs etc.
</p>
</div>
</div>

<div id="outline-container-org19b4477" class="outline-4">
<h4 id="org19b4477"><span class="section-number-4">3.2.5.</span> How to launch a job &#x2013; GPU allocation</h4>
<div class="outline-text-4" id="text-3-2-5">
<p>
There are many different types of GPUs available, some older than others. If you
wanted to allocate a job with a specific type of GPU you can use the
<code>--constraint</code> flag:
</p>

<div class="org-src-container">
<pre class="src src-bash">srun --time=00:10:00 <span style="color: #8b2252;">\</span>
     --partition=gpu <span style="color: #8b2252;">\</span>
     --gres=gpu:1 <span style="color: #8b2252;">\</span>
     --constraint=<span style="color: #8b2252;">'cuda61'</span> <span style="color: #8b2252;">\</span>
     --pty bash -l
</pre>
</div>

<p>
This command requests that our job run on the GPU partition, with 1 GPU
allocated that has the capability of running CUDA compute 61.
</p>

<p>
Or we can specify the type of GPU in the gres option:
</p>

<div class="org-src-container">
<pre class="src src-bash">srun --time=00:10:00 <span style="color: #8b2252;">\</span>
     --partition=gpu <span style="color: #8b2252;">\</span>
     --gres=gpu:2080:1 <span style="color: #8b2252;">\</span>
     --pty bash -l
</pre>
</div>
</div>
</div>

<div id="outline-container-org05655d1" class="outline-4">
<h4 id="org05655d1"><span class="section-number-4">3.2.6.</span> Learning more about nodes</h4>
<div class="outline-text-4" id="text-3-2-6">
<p>
To understand what each compute node has we can use the <code>scontrol</code> command.
</p>

<div class="org-src-container">
<pre class="src src-bash">scontrol show nodes
</pre>
</div>

<p>
Will list out all nodes and all capabilities of each node. Or just one node:
</p>

<div class="org-src-container">
<pre class="src src-bash">scontrol show node lisnode2
</pre>
</div>
</div>
</div>

<div id="outline-container-orga606571" class="outline-4">
<h4 id="orga606571"><span class="section-number-4">3.2.7.</span> How to launch a job &#x2013; sbatch</h4>
<div class="outline-text-4" id="text-3-2-7">
<p>
It can be quite inconvenient to launch an interactive job to run some compute,
and wait for the job to be allocated. If, instead, you have a long running
experiment that you want to run without any intervention from you, you can use
<code>sbatch</code>.
</p>

<p>
Sbatch will require us to write a small bash script that specifies how to run a
job and what to do once its allocated.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --time=00:01:00</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --job-name=my_new_job</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --output=my_new_job.out</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --error=my_new_job.err</span>

<span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">HOSTNAME</span>
</pre>
</div>

<p>
And run it:
</p>

<div class="org-src-container">
<pre class="src src-bash">sbatch my_job.sh
</pre>
</div>
</div>
</div>

<div id="outline-container-org8335e07" class="outline-4">
<h4 id="org8335e07"><span class="section-number-4">3.2.8.</span> How to launch a job &#x2013; sbatch</h4>
<div class="outline-text-4" id="text-3-2-8">
<p>
Notice that instead of supplying options to sbatch, we can instead record them
directly into the script using the <code>#SBATCH</code>. SLURM will examine this file,
looking for lines starting with this comment, and infer that the rest of the
line contains the options.
</p>

<p>
There are a few other options we've included that are very useful when running
non-interactive jobs. Firstly, we've given the job a name (<code>my_new_job</code>). This is
so we can different between many jobs that we might run at the same time. To
list out the jobs we currently have running we use <code>squeue</code>.
</p>

<div class="org-src-container">
<pre class="src src-bash">squeue
</pre>
</div>

<p>
By default, squeue will list all of the active jobs, even other peoples. To
specify only your jobs user the <code>--user</code> option:
</p>

<div class="org-src-container">
<pre class="src src-bash">squeue --user=jay.morgan
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3bda8d" class="outline-4">
<h4 id="orgb3bda8d"><span class="section-number-4">3.2.9.</span> How to launch a job &#x2013; sbatch</h4>
<div class="outline-text-4" id="text-3-2-9">
<p>
The other two options, <code>--output</code> and <code>--error</code> specify where the printed output and
printed errors will be stored. Since the job is being run on a different node,
by a non-interactive process, if you didn't include these lines, you wouldn't be
able to see what was being printed by <code>echo</code> or by any other process such as <code>print</code>
in Python.
</p>
</div>
</div>

<div id="outline-container-org086c578" class="outline-4">
<h4 id="org086c578"><span class="section-number-4">3.2.10.</span> Job Management &#x2013; squeue</h4>
<div class="outline-text-4" id="text-3-2-10">
<p>
When we list the jobs using <code>squeue</code> it will give us multiple columns of
information, such as:
</p>

<ul class="org-ul">
<li>JOBID &#x2013; the referable id of the job.</li>
<li>PARTITION &#x2013; the partition on which the job has been requested for.</li>
<li>NAME &#x2013; the name of the job.</li>
<li>USER &#x2013; the user who submitted the job.</li>
<li>ST &#x2013; the status, is the job currently running, waiting, or exiting?</li>
<li>TIME &#x2013; how long the job has been running for.</li>
<li>NODES &#x2013; how many nodes have been allocated to the job.</li>
</ul>
</div>
</div>

<div id="outline-container-orged2fe85" class="outline-4">
<h4 id="orged2fe85"><span class="section-number-4">3.2.11.</span> Job Management &#x2013; scancel</h4>
<div class="outline-text-4" id="text-3-2-11">
<p>
Let's say that we've submitted a job, but we've noticed that there was an error
in the code, and want to stop the job. For that, we use <code>scancel</code> and specify the
id of the job we wish to cancel:
</p>

<div class="org-src-container">
<pre class="src src-bash">scancel 158590
</pre>
</div>

<p>
After running this command, we should see, using <code>squeue</code>, that either the job is
finishing, or that its disappeared from our list (meaning that its completely
stopped).
</p>
</div>
</div>

<div id="outline-container-org9b02010" class="outline-4">
<h4 id="org9b02010"><span class="section-number-4">3.2.12.</span> Job Management &#x2013; sacct</h4>
<div class="outline-text-4" id="text-3-2-12">
<p>
If our job has finished, or exited and is no longer in <code>squeue</code>, we can use <code>sacct</code>
to get a history of the jobs.
</p>

<p>
<code>sacct</code> will list all of your jobs within some default window of time. If we want
to change this window we can use the <code>--starttime</code> and <code>--endtime</code> options.
</p>

<p>
Valid time formats are:
</p>
<ul class="org-ul">
<li>HH:MM[:SS][AM|PM]</li>
<li>MMDD[YY][-HH:MM[:SS]]</li>
<li>MM.DD[.YY][-HH:MM[:SS]]</li>
<li>MM/DD[/YY][-HH:MM[:SS]]</li>
<li>YYYY-MM-DD[THH:MM[:SS]]</li>
<li>today, midnight, noon, fika (3 PM), teatime (4 PM)</li>
<li>now[{+|-}count[seconds(default)|minutes|hours|days|weeks]]</li>
</ul>
</div>
</div>

<div id="outline-container-org399087f" class="outline-4">
<h4 id="org399087f"><span class="section-number-4">3.2.13.</span> Job Task Arrays &#x2013; motivation</h4>
<div class="outline-text-4" id="text-3-2-13">
<p>
Task arrays allow you to submit many jobs of the same type. Why might this be
useful? Suppose you have a list of files that take a long time to process:
</p>

<ul class="org-ul">
<li><code>file_0.txt</code></li>
<li><code>file_1.txt</code></li>
<li><code>file_2.txt</code></li>
</ul>

<p>
Or you have some computation script, such as deep learning training script, that
takes uses a hyperparameter which can be tuned to achieve different performance
results:
</p>

<div class="org-src-container">
<pre class="src src-bash">python train.py --learning-rate 0.001
</pre>
</div>

<p>
Instead of a creating a sbatch script for each value of hyperparameter, or
sequentially enumerating the values, you can use a job task array to spawn
multiple jobs with slightly different values.
</p>
</div>
</div>

<div id="outline-container-org5259b7e" class="outline-4">
<h4 id="org5259b7e"><span class="section-number-4">3.2.14.</span> Job Task Arrays &#x2013; how to</h4>
<div class="outline-text-4" id="text-3-2-14">
<p>
First, we will look at how to actually submit an array of tasks. To create an
task array, you will need to add the <code>--array</code> options to your sbatch script:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --job-name=my_task_array</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --array=1-5</span>

...
</pre>
</div>

<p>
Here we are creating an array of tasks numbered from 1-5. When you submit this
script, you will see five tasks submitted to the queue.
</p>
</div>
</div>

<div id="outline-container-org767811f" class="outline-4">
<h4 id="org767811f"><span class="section-number-4">3.2.15.</span> Job Task Arrays &#x2013; how to</h4>
<div class="outline-text-4" id="text-3-2-15">
<p>
Now that we know how to create an array of tasks, we will want to do something
useful with it. When you create an array, each individual task will have a
unique variable called <code>SLURM_ARRAY_TASK_ID</code>. So for example, if we launch an
array of 5 tasks, the first task will have the value <code>1</code>. Why is this useful?
Well, we can use this variable to alter the program slightly. Take for example
our list of files we need to process:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --job-name=my_task_array</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --array=0-4</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --time=00:10:00</span>

<span style="color: #a0522d;">FILENAME</span>=<span style="color: #8b2252;">"file_${SLURM_ARRAY_TASK_ID}.txt"</span>
python process.py $<span style="color: #a0522d;">FILENAME</span>
</pre>
</div>

<p>
This will create a new bash variable called <code>FILENAME</code> by concatenating <code>file_</code> the
current task's (i.e. 0, for the first task, 1 for the second task, etc) and
<code>.txt</code>.
</p>
</div>
</div>

<div id="outline-container-org3f2112b" class="outline-4">
<h4 id="org3f2112b"><span class="section-number-4">3.2.16.</span> Job Task Arrays &#x2013; how to</h4>
<div class="outline-text-4" id="text-3-2-16">
<p>
If we run the previous example, we will see that we have five jobs named exactly
the same thing <code>my_task_array</code>. This is okay, but we can be a little bit more
clear as to which task is running, i.e. which task is processing which file?
</p>

<p>
We can use some special variables in our bash script to make this more
clear. These are <code>%A</code> that is the main job id, and <code>%a</code> that is the task array id.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --job-name=my_task_array.%A_%a</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --output=my_task_array.%A_%a.out</span>
...
</pre>
</div>

<p>
Now, every task in our array will have a slightly different name because of the
<code>%a</code> and therefore we will be able to determine which job is processing which
file.
</p>
</div>
</div>

<div id="outline-container-org12cb7e9" class="outline-4">
<h4 id="org12cb7e9"><span class="section-number-4">3.2.17.</span> Job Task Arrays &#x2013; how to</h4>
<div class="outline-text-4" id="text-3-2-17">
<p>
Let's move on to the second example, where we have a Deep Learning training
program and we want to try different parameters. In this case, we can again use
a task array.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --array=1-10</span>
</pre>
</div>

<p>
We could either pass the <code>SLURM_ARRAY_TASK_ID</code> as a command line argument to the
script:
</p>

<div class="org-src-container">
<pre class="src src-bash">python training.py --learning-rate $<span style="color: #a0522d;">SLURM_ARRAY_TASK_ID</span>
</pre>
</div>

<p>
But in this case, we could have to properly calculate the correct learning rate
from the <code>SLURM_ARRAY_TASK_ID</code> value (remember that in my sbatch script I set
<code>--array=1-5</code>). But bash only performs integer arithmetic, therefore we will need
to calculate the correct learning rate in something else.
</p>
</div>
</div>

<div id="outline-container-org2f6687d" class="outline-4">
<h4 id="org2f6687d"><span class="section-number-4">3.2.18.</span> Job Task Arrays &#x2013; how to</h4>
<div class="outline-text-4" id="text-3-2-18">
<p>
Instead of passing the learning rate via a command line argument. We can get the
value directly from our python script and calculate the value.
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #a020f0;">import</span> os

<span style="color: #a0522d;">task_id</span> = <span style="color: #483d8b;">int</span>(os.environ[<span style="color: #8b2252;">"SLURM_ARRAY_TASK_ID"</span>])
<span style="color: #a0522d;">learning_rate</span> = task_id / 100
</pre>
</div>

<p>
Here we are using the builtin <code>os</code> module in Python, getting the environment
variable from the dictionary <code>environ</code> and parsing the value as an integer. Then
we can calculate the appropriate learning rate using this value. So for example,
if <code>SLURM_ARRAY_TASK_ID</code> is set to 1. Our learning rate would be 0.01 for this
task.
</p>
</div>
</div>

<div id="outline-container-orge5395db" class="outline-4">
<h4 id="orge5395db"><span class="section-number-4">3.2.19.</span> Job Task Arrays &#x2013; how to</h4>
<div class="outline-text-4" id="text-3-2-19">
<p>
If you're creating a job task array, you may want to create hundreds of
jobs. And of course, you don't want to use up the entire cluster leaving no
resources for anybody else! Therefore, you will only want a maximum number of
tasks to run at any one time.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --array=1-100%5</span>
</pre>
</div>

<p>
This will create a job task array of 100 jobs numbered from 1 to 100. But we
have added an additional argument <code>%5</code> which means that only 5 jobs can run at any
one time for this task array. If you have five tasks running, the other 95 tasks
will wait.
</p>

<p>
If, at any point, you want to change how many jobs can run simultaineously, you
can update this 'throttle' value using <code>scontrol</code>:
</p>

<div class="org-src-container">
<pre class="src src-bash">scontrol update <span style="color: #a0522d;">ArrayTaskThrottle</span>=&lt;count&gt; <span style="color: #a0522d;">JobId</span>=&lt;jobID&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb7b425a" class="outline-4">
<h4 id="orgb7b425a"><span class="section-number-4">3.2.20.</span> Job Task Arrays &#x2013; how to</h4>
<div class="outline-text-4" id="text-3-2-20">
<p>
So if we've already launched a job task array with the job id of <code>50602</code> that has
a throttle value of 5 (only 5 tasks will run at once), we can change it to 10
using:
</p>

<div class="org-src-container">
<pre class="src src-bash">scontrol update <span style="color: #a0522d;">ArrayTaskThrottle</span>=10 <span style="color: #a0522d;">JobId</span>=50602
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga4c5a07" class="outline-3">
<h3 id="orga4c5a07"><span class="section-number-3">3.3.</span> A guided walk through</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-org0de13b3" class="outline-4">
<h4 id="org0de13b3"><span class="section-number-4">3.3.1.</span> A guided walk through &#x2013; environment</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
In this section we're going to give an example walk through of working with the
HPC cluster. In this example, we're going to write our scripts locally,
including the slurm submission script, and when they're ready, we'll send them
to the cluster to perform the actual computation.
</p>

<p>
Let's imagine we're starting a new project, and are programming our scripts in
Python. Now is a good time to create a new conda environment to install our
packages we're going to use for our research. We'll create this environment with
(replacing <code>&lt;env-name&gt;</code> with whatever we want to call this environment):
</p>

<div class="org-src-container">
<pre class="src src-bash">conda create --name &lt;env-name&gt;
</pre>
</div>

<p>
and then activate it:
</p>

<div class="org-src-container">
<pre class="src src-bash">conda activate &lt;env-name&gt;
conda install <span style="color: #a0522d;">python</span>=3.9
</pre>
</div>
</div>
</div>

<div id="outline-container-org0473e3f" class="outline-4">
<h4 id="org0473e3f"><span class="section-number-4">3.3.2.</span> Writing our scripts</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
Let us also image we've just wrote the following script to create a lorenz
attractor: <a href="https://pageperso.lis-lab.fr/jay.morgan/resources/2021-programming-level-up/lectures/week-5/lorenz.py">lorenz.py</a>
</p>

<p>
The specific implementation of this script is not particularly important for
this walk through. Just know that we're importing a few packages such as numpy
and matplotlib. Then, we're performing some computation, and saving the results
to analyse later. As this script uses external libraries, we need to install
them:
</p>

<div class="org-src-container">
<pre class="src src-bash">conda install numpy matplotlib
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ccc76d" class="outline-4">
<h4 id="org5ccc76d"><span class="section-number-4">3.3.3.</span> Writing our job submission script</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
Since we want our calculations to be performed on the cluster, we will need to
also write a job submission script (let's call this <code>submit-job.sh</code>) in bash to
pass to SLURM.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --job-name=lorenz_attractor</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --output=lorenz_attractor.log</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --error=lorenz_attractor.log</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">SBATCH --time=00:10:00</span>

python lorenz.py
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b18daf" class="outline-4">
<h4 id="org4b18daf"><span class="section-number-4">3.3.4.</span> Replicating our environment on the cluster</h4>
<div class="outline-text-4" id="text-3-3-4">
<p>
As we've installed external packages in our local development environment, we
will want to ensure that when we run the calculations on the cluster, it will be
using the same versions of packages. Conda makes this a lot easier. First, we
export our environment to a recipe file:
</p>

<div class="org-src-container">
<pre class="src src-bash">conda env export --no-builds &gt; environment.yml
</pre>
</div>
</div>
</div>

<div id="outline-container-org19ded2a" class="outline-4">
<h4 id="org19ded2a"><span class="section-number-4">3.3.5.</span> Sending our scripts to the cluster</h4>
<div class="outline-text-4" id="text-3-3-5">
<p>
All of our scripts are ready! We can now transfer them from our personal
computer, to the cluster. The files we need to transfer are:
</p>

<ul class="org-ul">
<li><code>lorenz.py</code></li>
<li><code>environment.yml</code></li>
<li><code>submit-job.sh</code></li>
</ul>

<p>
While we can send a folder (and the containing files), let's send them one at a time:
</p>

<div class="org-src-container">
<pre class="src src-bash">scp lorenz.py &lt;hostname&gt;:&lt;destination-path&gt;
scp environment.yml &lt;hostname&gt;:&lt;destination-path&gt;
scp submit-job.sh &lt;hostname&gt;:&lt;destination-path&gt;
</pre>
</div>

<p>
where <code>&lt;hostname&gt;</code> is the hostname/IP address that you've used to connect to the
login node on the cluster before. <code>&lt;destination-path&gt;</code> is the path to where you
want to save the files.
</p>
</div>
</div>

<div id="outline-container-org16cc28f" class="outline-4">
<h4 id="org16cc28f"><span class="section-number-4">3.3.6.</span> Logging into the cluster</h4>
<div class="outline-text-4" id="text-3-3-6">
<p>
Now that our files are on the cluster, we can login:
</p>

<div class="org-src-container">
<pre class="src src-bash">ssh &lt;username&gt;@&lt;hostname&gt;
</pre>
</div>

<p>
At which point, we've logged into the login node, and then we need to change
directory to where we saved the files:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #483d8b;">cd</span> &lt;destination-path&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e684de" class="outline-4">
<h4 id="org7e684de"><span class="section-number-4">3.3.7.</span> Re-creating our development environment</h4>
<div class="outline-text-4" id="text-3-3-7">
<p>
Now that we're in the same folder as our scripts, we're almost ready to submit
our job. First, we need to recreate our development environment from our
<code>environment.yml</code> file.
</p>

<div class="org-src-container">
<pre class="src src-bash">conda env create -f environment.yml
</pre>
</div>

<p>
And activate our newly created environment:
</p>

<div class="org-src-container">
<pre class="src src-bash">conda activate &lt;env-name&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c77380" class="outline-4">
<h4 id="org7c77380"><span class="section-number-4">3.3.8.</span> Submitting our job</h4>
<div class="outline-text-4" id="text-3-3-8">
<p>
Now we can submit our job:
</p>

<div class="org-src-container">
<pre class="src src-bash">sbatch submit-job.sh
</pre>
</div>

<p>
We can check the progress of our job with <code>squeue</code>, or its already completed, look
at the job history with <code>sacct</code>.
</p>
</div>
</div>

<div id="outline-container-orgbf52f1a" class="outline-4">
<h4 id="orgbf52f1a"><span class="section-number-4">3.3.9.</span> Downloading the results</h4>
<div class="outline-text-4" id="text-3-3-9">
<p>
If our job runs successfully, a <code>data.pkl</code> file will be created. Back on our local
computers, we will need to run the following to download it:
</p>

<div class="org-src-container">
<pre class="src src-bash">scp &lt;hostname&gt;:&lt;destination-path&gt;/data.pkl ./
</pre>
</div>

<p>
This will download the file into the current directory.
</p>
</div>
</div>

<div id="outline-container-orga0284ff" class="outline-4">
<h4 id="orga0284ff"><span class="section-number-4">3.3.10.</span> Analysing the results</h4>
<div class="outline-text-4" id="text-3-3-10">
<p>
With the <code>data.pkl</code> file downloaded, we can visualise the results using
<code>plot_lorenz.py</code>:
<a href="https://pageperso.lis-lab.fr/jay.morgan/resources/2021-programming-level-up/lectures/week-5/plot-lorenz.py">https://pageperso.lis-lab.fr/jay.morgan/resources/2021-programming-level-up/lectures/week-5/plot-lorenz.py</a>
</p>

<p>
If everything has been run correctly, you should see a plot of the lorenz attractor.
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 11th October 2021</p>
<p class="author">Author: Jay Morgan</p>
<p class="date">Created: 2021-12-04 sam. 16:09</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
